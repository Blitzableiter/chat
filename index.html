<!DOCTYPE html>
<html>
  <head>
    <title>Dat Chat Tho</title>
    <link href="/public/lib/css/styles.css" type="text/css" rel="stylesheet" />
  </head>

  <body>
    <div class="header">
      <label>Who dis?</label>
      <input id="username" autocomplete="off" placeholder="Username" />
      <label id="usernameErr">Gimme dat sweet sweet name</label>
    </div>
    <div id="messdiv">
      <ul id="messages">
        <li id="firstMessage">Welcome!</li>
      </ul>
    </div>
    <form class="textboxForm" action="">
      <input id="m" autocomplete="off" /><button id="sendButton">Send</button>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      $(function() {
        var socket = io();
        $("#username").change(function() {
          if (
            $("#username")
              .val()
              .trim()
          ) {
            $("#usernameErr").text("");
          } else {
            $("#usernameErr").text("Gimme dat sweet sweet name");
          }
        });
        $("form").submit(function() {
          socket.emit("chat message", $("#m").val(), $("#username").val());
          $("#m").val("");
          return false;
        });
        socket.on("chat message", function(msg, usr) {
          var date = new Date();
          $("#messages").prepend(
            $("<li>").text(usr + " (" + date.toLocaleTimeString() + "): " + msg)
          );
        });
        socket.on("new connection", function(socket) {
          var date = new Date();
          $("#messages").prepend(
            $("<li class='liMessage'>").text(
              date.toLocaleTimeString() + ": Somebody joined. Ew."
            )
          );
        });
        socket.on("new disconnection", function(socket) {
          var date = new Date();
          $("#messages").prepend(
            $("<li class='liMessage'>").text(
              date.toLocaleTimeString() +
                ": Somebody left. Finally there is some peace..."
            )
          );
        });
      });
    </script>
  </body>
</html>
